function PivotSummaries(){return this}function PivotUtils(){return this}function pivot(e){this._fields={};this._filters={};this._rawData=[];this._data=[];this._dataFilters={};this._displayFields={rowLabels:{},columnLabels:{},summaries:{}};this._results=undefined;this._resultsColumns=undefined;this._utils=new PivotUtils;this._summarize_functions=new PivotSummaries;this.options=$.extend(true,{},e);return this}function PivotController(e,t){this.elem=e;this.$elem=$(e);this.pivot=t.pivot;delete t.pivot;this.options=$.extend(true,{},this.defaults(),t);this.templates=this.options.templates;delete t.templates;this.plugins={};this.$elem.trigger("init");var n=this;$.when(this.register_plugins(),this.build_controllers(),this.initialize()).done(function(){delete n.options.plugins;n.$elem.trigger("update")});if(this.options.autorun)this.run_plugins();this.$elem.trigger("ready");return this}function PivotChart(e,t){this.elem=e;this.$elem=$(e);if(t.pivot==undefined&&typeof t.pivot!=="object"){throw"options.pivot must contain a pivot object"}this.pivot=t.pivot;delete t.pivot;this.y_axes=new PivotChartYAxes(this.pivot);this.series=undefined;this.chart=undefined;this.options=$.extend(true,{},this.defaults(),t);this.$elem.trigger("init");this.initialize();this.$elem.trigger("update");return this}function PivotChartYAxes(e){this.pivot_config=e;this.axes=[]}function PivotChartYAxis(e,t,n){this.index=undefined;this.pivot=n;this.options=(new PivotChartYAxisConfig(this.defaults(e),t)).get();this.options=(new PivotChartYAxisConfig(this.options,this.getYAxisConfigFromPivotField())).get();return this}function PivotChartYAxisConfig(){this.options=this.defaults();for(var e=0;e<arguments.length;e++){this.options=$.extend(true,this.options,arguments[e])}return this}function PivotChartConfig(){this.options=this.defaults();for(var e=0;e<arguments.length;e++){this.options=$.extend(true,this.options,arguments[e])}return this}function PivotChartSeries(e,t){this.series={};this.pivot=e;this.y_axes=t;return this}function PivotChartSingleSeries(e,t,n,r){this.y_axes=e;this.pivot=t;this.name=n;this.y_axis=this.y_axes.register(this.name);this.options=new PivotChartSeriesConfig({},this.getSeriesConfigFromPivotfield(),{yAxis:this.y_axis.index});this.data=[];return this}function PivotChartSeriesConfig(){this.options=this.defaults();for(var e=0;e<arguments.length;e++){this.options=$.extend(true,this.options,arguments[e])}return this}function pivot_table(e,t){this.elem=e;this.$elem=$(e);this.options=$.extend(true,this.defaults(),t);if(this.options.pivot==undefined&&typeof this.options.pivot!=="object"){throw"options.pivot must contain a pivot object"}this.pivot=t.pivot;delete t.pivot;this.$elem.trigger("init");this.initialize();this.$elem.trigger("update");return this}PivotSummaries.prototype.sum=function(e,t){var n=0,r=-1,i=e.length;while(++r<i){n+=e[r][t.dataSource]}return n};PivotSummaries.prototype.avg=function(e,t){return this.sum(e,t)/e.length};PivotSummaries.prototype.count=function(e,t){return e.length};PivotSummaries.prototype.percent=function(e,t){var n=t.summarizable_functions.base;var r=t.summarizable_functions.percent;var i=0;var s=0;$.each(e,function(e,t){i=i+n(t);s=s+r(t)});return parseFloat((s/i*100).toFixed(2))};PivotUtils.prototype.pad=function(e,t,n,r){if(r===undefined)r=" ";t=t.toString();r=r.toString();while(t.length<n){if(e==="left")t=r+t;else t=t+r}return t};PivotUtils.prototype.padLeft=function(e,t,n){return this.pad("left",e,t,n)};PivotUtils.prototype.padRight=function(e,t,n){return this.pad("right",e,t,n)};PivotUtils.prototype.formatDate=function(e){return e.getUTCFullYear()+"-"+this.padLeft(e.getUTCMonth()+1,2,"0")+"-"+this.padLeft(e.getUTCDate(),2,"0")};PivotUtils.prototype.formatTime=function(e){return this.formatDate(e)+" "+this.padLeft(e.getUTCHours(),2,"0")+":"+this.padLeft(e.getUTCMinutes(),2,"0")};PivotUtils.prototype.isArray=function(e){if(!Array.isArray)return this.objectType(e)=="array";else return Array.isArray(e)};PivotUtils.prototype.isRegexp=function(e){return this.objectType(e)=="regexp"};PivotUtils.prototype.shallowClone=function(e){var t={};for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}return t};PivotUtils.prototype.objectKeys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(key in e){t.push(key)}return t};PivotUtils.prototype.objectType=function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};PivotUtils.prototype.sortNumerically=function(e){return e.sort(function(e,t){return e-t})};pivot.prototype.init=function(e){var t=this,n=new $.Deferred;if(e==undefined)e=this.options;if(e.fields!==undefined)this.setFields(e.fields);if(e.filters!==undefined)this.setFilters(e.filters);if(e.rowLabels!==undefined)this.setRowLabelDisplayFields(e.rowLabels);if(e.columnLabels!==undefined)this.setColumnLabelDisplayFields(e.columnLabels);if(e.summaries!==undefined)this.setSummaryDisplayFields(e.summaries);if(e.url!==undefined){$.when(this.fetch()).then(function(e){$.when(t.process(e)).then(function(e){n.resolve(e)})})}else{$.when(t.process(e)).then(function(e){n.resolve(e)})}return n.promise()};pivot.prototype.reset=function(e){this.init($.extend({},e))};pivot.prototype.results=function(){return{all:$.proxy(this.getFormattedResults,this),columns:$.proxy(this.getColumnResults,this)}};pivot.prototype.utils=function(){return{pad:this._utils.pad,padRight:this._utils.padRight,padLeft:this._utils.padLeft,formatDate:this._utils.formatDate,formatTime:this._utils.formatTime,isArray:this._utils.isArray,isRegExp:this._utils.isRegExp,shallowClone:this._utils.shallowClone,objectKeys:this._utils.objectKeys,objectType:this._utils.objectType,sortNumerically:this._utils.sortNumerically}};pivot.prototype.fields=function(e){var t={columnLabelable:$.proxy(this.restrictFields,this,"columnLabelable"),rowLabelable:$.proxy(this.restrictFields,this,"rowLabelable"),summarizable:$.proxy(this.restrictFields,this,"summarizable"),filterable:$.proxy(this.restrictFields,this,"filterable"),pseudo:$.proxy(this.restrictFields,this,"pseudo"),clone:$.proxy(this.cloneFields,this),add:$.proxy(this.appendField,this),all:$.proxy(this.getFields,this),set:$.proxy(this.setFields,this),get:$.proxy(this.getField,this)};if(e!==undefined)return t[e];return t};pivot.prototype.filters=function(e){var t={all:$.proxy(this.getFilters,this),set:$.proxy(this.setFilters,this),apply:$.proxy(this.applyFilter,this),add:$.proxy(this.appendFilter,this)};if(e!==undefined)return t[e];return t};pivot.prototype.display=function(){return{all:$.proxy(this.pivotDisplayAll,this),rowLabels:$.proxy(this.pivotDisplayRowLabels,this),columnLabels:$.proxy(this.pivotDisplayColumnLabels,this),summaries:$.proxy(this.pivotDisplaySummaries,this)}};pivot.prototype.config=function(e){return{fields:e===undefined?$.proxy(this.cloneFields(),this):this.getFields(),filters:$.proxy(this.getFilters,this),rowLabels:this._utils.objectKeys(this._displayFields.rowLabels),columnLabels:this._utils.objectKeys(this._displayFields.columnLabels),summaries:this._utils.objectKeys(this._displayFields.summaries)}};pivot.prototype.data=function(){var e={raw:this._rawData,all:this._data};if(type!==undefined)return e[type];return e};pivot.prototype.pivotDisplaySummaries=function(){var e=this;return{set:$.proxy(this.setSummaryDisplayFields,this),get:function(){return e._displayFields.summaries}}};pivot.prototype.pivotDisplayAll=function(){return this._displayFields};pivot.prototype.pivotDisplayRowLabels=function(){var e=this;return{set:$.proxy(this.setRowLabelDisplayFields,this),get:function(){return e._displayFields.rowLabels}}};pivot.prototype.pivotDisplayColumnLabels=function(){var e=this;return{set:$.proxy(this.setColumnLabelDisplayFields,this),get:function(){return e._displayFields.columnLabels}}};pivot.prototype.setFields=function(e){this._fields={};var t=-1,n=e.length;while(++t<n){this.appendField(e[t])}};pivot.prototype.setFilters=function(e){if(typeof e==="undefined")e={};this._filters=e;this.resetResults();this.castFilterValues()};pivot.prototype.setRowLabelDisplayFields=function(e){this.setDisplayFields("rowLabels",e)};pivot.prototype.setColumnLabelDisplayFields=function(e){this.setDisplayFields("columnLabels",e)};pivot.prototype.setSummaryDisplayFields=function(e){this.setDisplayFields("summaries",e)};pivot.prototype.setDisplayFields=function(e,t){this._displayFields[e]={};this.resetResults();var n=-1,r=t.length;while(++n<r){this.appendDisplayField(e,t[n])}};pivot.prototype.getColumnResults=function(){if(this._results===undefined||this._resultsColumns===undefined)this.getFormattedResults();return this._resultsColumns};pivot.prototype.getResultArray=function(){var e=[],t=this._utils.objectKeys(this._results).sort(),n=-1,r=t.length;while(++n<r){e.push(this._results[t[n]])}return e};pivot.prototype.getSummaryResults=function(e){var t={};for(var n in this._displayFields.summaries){if(this._displayFields.summaries.hasOwnProperty(n)){e[n]=this._fields[n].summarizeFunction(e.rows,this._fields[n]);e[n]=this._fields[n].displayFunction(e[n],n)}}return e};pivot.prototype.getFields=function(){return this._fields};pivot.prototype.getField=function(e){return this._fields[e]};pivot.prototype.getFilters=function(){return this._filters};pivot.prototype.fetch=function(){var e=this,t=new $.Deferred;re=/\.json$/i,dataType=re.test(this.options.url)?"text/json":"text/csv";var n=typeof this.options.url==="function"?this.options.url():this.options.url;$.ajax({url:n,dataType:"text",accepts:"text/csv",success:function(e,n){if(dataType==="text/json")t.resolve({json:e});else t.resolve({csv:e})}});return t.promise()};pivot.prototype.process=function(e){var t=this,n=new $.Deferred;if(e.csv!=="undefined"){$.when(this.processCSV(e.csv)).then(function(e){n.resolve(e)})}else if(e.json!=="undefined"){$.when(this.processJSON(e.json)).then(function(e){n.resolve(e)})}else{n.reject({message:"Unsupported data type"})}return n.promise()};pivot.prototype.processJSON=function(e){var t,n=new $.Deferred,r=this.restrictFields("pseudo");if(objectType(e)==="string")e=JSON.parse(e);this._rawData=[];var i={},s=-1,o=e.length;while(++s<o){if(s===0)t=this.processHeaderRow(e[s]);else this._rawData.push(this.processRow(e[s],t,r))}n.resolve({message:"json data processed"});return n.promise()};pivot.prototype.processCSV=function(e){var t,n=this,r=new $.Deferred,i=this.restrictFields("pseudo");this._rawData=this.processRows(e,function(e,r){if(r===0)t=n.processHeaderRow(e);else return n.processRow(e,t,i)});r.resolve({message:"csv data processed"});return r.promise()};pivot.prototype.displayFieldValue=function(e,t){var n;if(this._utils.objectType(t)==="string")n=this._fields[t];if(n===undefined)n=this.appendField(t);switch(n.type){case"cents":return"$"+(e/100).toFixed(2);case"currency":return"$"+e.toFixed(2);case"date":return this._utils.formatDate(new Date(e));case"time":return this._utils.formatTime(new Date(e));default:return e}};pivot.prototype.populateSummaryColumnsResults=function(){for(var e in this._displayFields.summaries){if(this._displayFields.summaries.hasOwnProperty(e))this._resultsColumns.push({fieldName:e,width:1,type:"summary"})}return this._resultsColumns};pivot.prototype.getFormattedResults=function(){if(this._results!==undefined&&this._resultsColumns!==undefined)return this.getResultArray();this.applyFilter();this._results={};this._resultsColumns=[];this.processRowLabelResults();if(this._utils.objectKeys(this._displayFields.columnLabels).length>0){this.processColumnLabelResults()}else{this.populateSummaryColumnsResults();this.processSummaryResults()}return this.getResultArray()};pivot.prototype.processSummaryResults=function(){for(var e in this._results){this.getSummaryResults(this._results[e])}return this._results};pivot.prototype.processRowLabelResults=function(){var e=-1,t=this._data.length,n;while(++e<t){var r=this._data[e],i="";for(var s in this._displayFields.rowLabels){if(this._displayFields.rowLabels.hasOwnProperty(s)){if(e===0)this._resultsColumns.push({fieldName:s,width:1,type:"row"});i+=s+":"+r[s]+"|"}}if(this._results[i]===undefined){this._results[i]={};for(var s in this._displayFields.rowLabels){if(this._displayFields.rowLabels.hasOwnProperty(s)){this._results[i][s]=this._fields[s].displayFunction(r[s],s)}}this._results[i].rows=[]}this._results[i].rows.push(r)}};pivot.prototype.processColumnLabelResults=function(){for(var e in this._displayFields.columnLabels){if(this._displayFields.columnLabels.hasOwnProperty(e)){var t={};for(var n in this._results){var r=this.pluckValues(this._results[n].rows,this._fields[e]);for(var i in r){if(t[i]===undefined)t[i]=1;else t[i]+=1;this._results[n][i]=this.getSummaryResults(r[i])}}this.populateColumnLabelColumnsResults(e,t)}}return this._results};pivot.prototype.pluckValues=function(e,t){var n=-1,r=e.length,i={};while(++n<r){var s=e[n][t.name];if(i[s]===undefined)i[s]={rows:[]};i[s].rows.push(e[n])}return i};pivot.prototype.populateColumnLabelColumnsResults=function(e,t){var n=this._utils.objectKeys(t).sort(this._fields[e].sortFunction),r=-1,i=n.length,s=this._utils.objectKeys(this._displayFields.summaries).length;while(++r<i){this._resultsColumns.push({fieldName:n[r],width:s,type:"column"})}return this._resultsColumns};pivot.prototype.cloneFields=function(){var e=[];for(var t in this._fields){var n={};for(var r in this._fields[t]){if(this._fields[t].hasOwnProperty(r)&&r!=="values")n[r]=this._fields[t][r]}e.push(n)}return e};pivot.prototype.restrictFields=function(e){var t=[];for(var n in this._fields){if(this._fields.hasOwnProperty(n)&&this._fields[n][e]===true){t.push(this._fields[n])}}return t};pivot.prototype.matchesFilter=function(e,t){if(this._utils.isArray(e)){var n=-1,r=e.length;while(++n<r){if(e[n]===t)return true}}else if(this._utils.isRegexp(e)){return e.test(t)}else{return t===e}return false};pivot.prototype.preserveFilteredData=function(){var e=0,t=this._utils.objectKeys(this._dataFilters).length;for(var n in this._dataFilters){if(this._dataFilters.hasOwnProperty(n)&&this._dataFilters.hasOwnProperty(n)&&this._filters[n]===this._dataFilters[n])e+=1}return t>0&&e>=t};pivot.prototype.applyFilter=function(e){var t=this._data,n=[];if(e!==undefined)this.setFilters(e);var r=this.preserveFilteredData();if(r){t=this._data}else{t=this._rawData}var i=t.length,s=this._utils.objectKeys(this._filters).length,o=-1;while(++o<i){var u=t[o],a=0;for(var f in this._filters){if(this._filters.hasOwnProperty(f)&&u.hasOwnProperty(f)&&this.matchesFilter(this._filters[f],u[f]))a+=1}if(a===s){n.push(u)}}this._data=n;thisdataFilters=this._utils.shallowClone(this._filters);this.resetResults();return this._data};pivot.prototype.appendFilter=function(e){for(var t in e){if(e.hasOwnProperty(t))this._filters[t]=e[t]}this.castFilterValues()};pivot.prototype.processHeaderRow=function(e){var t=[];var n={},r=-1,i=e.length;while(++r<i){var s=this._fields[e[r]];if(s===undefined){s=this.appendField(e[r])}t.push(s)}return t};pivot.prototype.processRows=function(e,t){function f(){if(s.lastIndex>=e.length)return r;if(a){a=false;return n}var t=s.lastIndex;if(e.charCodeAt(t)===34){var i=t;while(i++<e.length){if(e.charCodeAt(i)===34){if(e.charCodeAt(i+1)!==34)break;i++}}s.lastIndex=i+2;var o=e.charCodeAt(i+1);if(o===13){a=true;if(e.charCodeAt(i+2)===10)s.lastIndex++}else if(o===10){a=true}return e.substring(t+1,i).replace(/""/g,'"')}var u=s.exec(e);if(u){a=u[0].charCodeAt(0)!==44;return e.substring(t,u.index)}s.lastIndex=e.length;return e.substring(t)}var n={},r={},i=[],s=/\r\n|[,\r\n]/g,o=0,u,a;s.lastIndex=0;while((u=f())!==r){var l=[];while(u!==n&&u!==r){l.push(u);u=f()}if(t&&!(l=t(l,o++)))continue;i.push(l)}return i};pivot.prototype.processRow=function(e,t,n){var r={},i=-1,s=t.length;while(++i<s){var o=this.castFieldValue(t[i].name,e[i]);r[t[i].name]=o;this.addFieldValue(t[i].name,o)}i=-1;s=n.length;while(++i<s){var u=n[i],o=this.castFieldValue(u.name,u.pseudoFunction(r,u));r[u.name]=o;this.addFieldValue(u.name,o)}return r};pivot.prototype.resetResults=function(){this._results=undefined;this._resultsColumns=undefined};pivot.prototype.appendDisplayField=function(e,t){if(this._utils.objectType(t)==="string")t=this._fields[t];this.resetResults();this._displayFields[e][t.name]=t};pivot.prototype.castFilterValues=function(e){if(e===undefined)e=this._filters;var t;for(t in e){if(e.hasOwnProperty(t)){if(this._utils.isRegexp(e[t])){}else if(this._utils.isArray(e[t])){var n=-1,r=e[t].length;while(++n<r){e[t][n]=this.castFieldValue(t,e[t][n])}}else{e[t]=this.castFieldValue(t,e[t])}}}};pivot.prototype.addFieldValue=function(e,t){if(this._fields[e]===undefined||this._fields[e].filterable===false)return;if(this._fields[e].values[t]===undefined){this._fields[e].values[t]={count:1,displayValue:this._fields[e].displayFunction(t,e)}}else{this._fields[e].values[t].count+=1}};pivot.prototype.castFieldValue=function(e,t){var n;if(this._utils.objectType(e)==="string")n=this._fields[e];if(n===undefined)n=this.appendField(e);switch(n.type){case"integer":case"cents":if(this._utils.objectType(t)==="number")return t;else return parseInt(t,10);case"float":case"currency":if(this._utils.objectType(t)==="number")return t;else return parseFloat(t,10);case"date":case"time":switch(this._utils.objectType(t)){case"number":case"date":return t;default:if(/^\d+$/.test(t))return parseInt(t);else return Date.parse(t)};default:return t.toString()}};pivot.prototype.appendField=function(e){if(this._utils.objectType(e)==="string")e={name:e};if(e.type===undefined)e.type="string";if(e.pseudo===undefined)e.pseudo=false;if(e.rowLabelable===undefined)e.rowLabelable=true;if(e.columnLabelable===undefined)e.columnLabelable=false;if(e.filterable===undefined)e.filterable=false;if(e.dataSource===undefined)e.dataSource=e.name;if(e.summarizable&&(e.rowLabelable||e.columnLabelable||e.filterable)){var t=this._utils.shallowClone(e);t.rowLabelable=false;t.filterable=false;t.dataSource=e.name;if(t.summarizable!==true)t.name=t.name+"_"+t.summarizable;else t.name=t.name+"_count";this.appendField(t);e.summarizable=false;e.summarizeFunction=undefined}else if(e.summarizable){if(e.summarizeFunction===undefined){if(typeof this._summarize_functions[e.summarizable]==="function"){e.summarizeFunction=this._summarize_functions[e.summarizable];e.summarizable=true}else{console.log("exception: "+e.summarizable+" is not a function")}}}else{e.summarizable=false}if(e.pseudo&&e.pseudoFunction===undefined)e.pseudoFunction=function(e){return""};if(e.displayFunction===undefined)e.displayFunction=$.proxy(this.displayFieldValue,this);e.values={};e.displayValues={};e.index=this._utils.objectKeys(this._fields).length;this._fields[e.name]=e;return e};PivotController.prototype.defaults=function(){return{autorun:true,build_filter_list:true,build_row_label_fields:true,build_column_label_fields:true,build_summary_fields:true,build_report_list:true,reports:[],plugins:[],elements:{filter_list:"#pivot-filter-list-"+uuid.v4(),row_label_fields:"#pivot-row-label-fields"+uuid.v4(),column_label_fields:"#pivot-column-label-fields-"+uuid.v4(),summary_fields:"#pivot-summary-fields-"+uuid.v4(),pivot_reports_list:"#pivot-reports-"+uuid.v4(),report_field_clickable:"a",pivot_filter_details:"#pivot-filter-details-"+uuid.v4()},templates:{build_select_filter_field:"#build-select-filter-field",build_filter_field:"#build-filter-field",build_filter_list:"#build-filter-list",build_toggle_fields:"#build-toggle-fields"},on_update:function(){this.update_plugins()}}};PivotController.prototype.initialize=function(){var e=this,t=new $.Deferred;this.$elem.bind("update",function(){e.update_filter_details();if(typeof e.options.on_update==="function"){$.proxy(e.options.on_update,e)()}});$(this.options.elements.filter_list).find("select:first").change(function(){e.build_filter_field($(this).val())});$(this.options.elements.row_label_fields).find(".row-labelable").on("change",function(t){var n=e.get_checked_fields("row-labelable");e.pivot.display()["rowLabels"]().set(n);e.$elem.trigger("update")});$(this.options.elements.column_label_fields).find(".column-labelable").on("change",function(t){var n=e.get_checked_fields("column-labelable");e.pivot.display()["columnLabels"]().set(n);e.$elem.trigger("update")});$(this.options.elements.summary_fields).find(".summary").on("change",function(t){var n=e.get_checked_fields("summary");e.pivot.display().summaries().set(n);e.$elem.trigger("update")});t.resolve();return t.promise()};PivotController.prototype.build_controllers=function(){var e=new $.Deferred;if(this.options.build_filter_list)this.build_filter_list();if(this.options.build_row_label_fields)this.build_toggle_fields(this.options.elements.row_label_fields,this.pivot.fields().rowLabelable(),"row-labelable");if(this.options.build_column_label_fields)this.build_toggle_fields(this.options.elements.column_label_fields,this.pivot.fields().columnLabelable(),"column-labelable");if(this.options.build_summary_fields)this.build_toggle_fields(this.options.elements.summary_fields,this.pivot.fields().summarizable(),"summary");if(this.options.build_report_list)this.build_report_fields(this.options.elements.pivot_reports_list,this.options.reports);e.resolve();return e.promise()};PivotController.prototype.install_filter_handlers=function(){var e=this;$(this.options.elements.filter_list).find("select.filter").each(function(){$(this).unbind()});$(this.options.elements.filter_list).find("input[type=text].filter").each(function(){$(this).unbind()});$(this.options.elements.filter_list).find(".remove-filter-field").each(function(){$(this).unbind()});$(this.options.elements.filter_list).find("select.filter").each(function(){$(this).on("change",function(t){var n=e.get_filter_restrictions();e.pivot.filters().set(n);e.$elem.trigger("update")})});$(this.options.elements.filter_list).find("input[type=text].filter").each(function(){$(this).on("keyup",function(t){var n=this,r=$(n).val();setTimeout(function(){if($(n).val()===r){var t=e.get_filter_restrictions();e.pivot.filters().set(t);e.$elem.trigger("update")}},500)})});$(this.options.elements.filter_list).find(".remove-filter-field").each(function(){var t=$(this);$(this).bind("click",function(){t.closest("form").remove();var n=e.get_filter_restrictions();e.pivot.filters().set(n);e.$elem.trigger("update")})})};PivotController.prototype.register_plugins=function(){var e=this,t=new $.Deferred;$.each(this.options.plugins,function(t,n){e.register_plugin(n)});t.resolve();return t.promise()};PivotController.prototype.register_plugin=function(e){var t=new $.Deferred;if(typeof e!=="object")e={};if(typeof e.id===undefined)t.reject({message:"Plugin id must be given to get bound to a DOM element"});if(!$(e.id).length)t.reject({message:"DOM element id "+e.id+" does not exist"});if(typeof e.name===undefined)t.reject({message:"No plugin name given"});this.plugins[e.name]={id:e.id,options:e.options};t.resolve();return t.promise()};PivotController.prototype.run_plugins=function(){var e=this;$.each(Object.keys(this.plugins),function(t,n){e.run_plugin(n)})};PivotController.prototype.run_plugin=function(e){var t=this.plugins[e];$(t.id)[e]($.extend(true,t.options,{pivot:this.pivot}))};PivotController.prototype.update_plugins=function(){var e=this;$.each(Object.keys(this.plugins),function(t,n){e.update_plugin(n)})};PivotController.prototype.update_plugin=function(e){var t=this.plugins[e];$(t.id).trigger("update")};PivotController.prototype.get_checked_fields=function(e){var t=[];this.$elem.find("."+e+":checked").each(function(e){t.push($(this).attr("data-field"))});return t};PivotController.prototype.get_filter_restrictions=function(){var e=this,t={};$(this.options.elements.filter_list).find(".filter").each(function(n){var r=e.pivot.fields().get($(this).attr("data-field"));if($(this).val()!==null&&$(this).val()[0]!==""){if(r.filterType==="regexp"){t[$(this).attr("data-field")]=new RegExp($(this).val(),"i")}else{t[$(this).attr("data-field")]=$(this).val()}}});return t};PivotController.prototype.build_filter_list=function(){var e=this;var t=uuid.v1();var n=useTemplate($(this.templates.build_filter_list).html(),[{id:t}]);$.each(this.pivot.fields().filterable(),function(e,t){var r=$("<option/>").html(t.name);n.append(r)});$(this.options.elements.filter_list).empty().append(n);$.each(this.pivot.filters().all(),function(t,n){e.build_filter_field(t,n)})};PivotController.prototype.build_regexp_filter_field=function(e,t){if(t===undefined)t="";return $("<input/>").attr("type","text").addr("data-field",e.name).addClass("filter form-control").val(t)};PivotController.prototype.build_select_filter_field=function(e,t){var n=useTemplate($(this.templates.build_select_filter_field).html(),[{field:e.name,multiselect:e.filterType==="multiselect"?"multiple":""}]);var r=[];for(value in e.values){r.push(value)}r=r.sort();$.each(r,function(r,i){var s=$("<option/>").attr("value",i).html(e.values[i].displayValue);if(i==t){s.attr("selected","selected")}n.append(s)});return n};PivotController.prototype.build_filter_field=function(e,t){if(e==="")return;var n,r,i=this,s=this.pivot.fields().get(e);if(s.filterType==="regexp")n=this.build_regexp_filter_field(s,t);else n=this.build_select_filter_field(s,t);var o=useTemplate($(this.templates.build_filter_field).html(),[{label:s.name,filter:n.outerHTML()}]);$(this.options.elements.filter_list).append(o);this.install_filter_handlers()};PivotController.prototype.build_toggle_fields=function(e,t,n){var r=this;$(e).empty();$.each(t,function(t,i){var s=useTemplate($(r.templates.build_toggle_fields).html(),[{label:i.name,class_name:n}]);$(e).append(s)});var i;if(n==="row-labelable")i=this.pivot.pivotDisplayRowLabels().get();else if(n==="column-labelable")i=this.pivot.pivotDisplayColumnLabels().get();else if(n==="summary")i=this.pivot.pivotDisplaySummaries().get();else throw"Unsupported class "+n;for(var s in i){var o=$(e+' input[data-field="'+s+'"]');o.prop("checked",true);this.order_checked(e,o)}$(e+" input").on("click",function(){if(this.checked){r.order_checked(e,this)}else{var t=$(this).parent().detach()[0];$(e).append(t)}})};PivotController.prototype.order_checked=function(e,t){var n=$(e+" input:checked");var r=$(t).parent().detach()[0];var i=$(e).children();if(n.length-1===0)$(e).prepend(r);else if(i.length<n.length)$(e).append(r);else $(i[n.length-1]).before(r)};PivotController.prototype.build_report_fields=function(e,t){var n=this;$(e).empty();$.each(t,function(t,r){var i=useTemplate($("#canned_report").html(),[{id:r.id,label:r.label,icon:typeof r.config.columnLabels==="undefined"||r.config.columnLabels.length==0?"fa-square-o":"fa-ban text-danger"}]);$(e).append(i);var s=i.find(n.options.elements.report_field_clickable);i.find(n.options.elements.report_field_clickable).bind("click",function(){n.pivot.filters().set(r.config.filters||{});n.pivot.setRowLabelDisplayFields(r.config.rowLabels||[]);n.pivot.setColumnLabelDisplayFields(r.config.columnLabels||[]);n.pivot.setSummaryDisplayFields(r.config.summaries||[]);n.$elem.trigger("update")})})};PivotController.prototype.update_filter_details=function(){var e="";var t="";$(this.options.elements.pivot_filter_details).empty();$.each(this.pivot.filters().all(),function(e,n){t+="<br/><em>"+e+"</em>"+" <i class='fa fa-angle-double-right'></i> "+n});if(t.length==0){t="<em>keine</em>"}e+="<b>Aktive Filter:</b> "+t+"<br/>";$(this.options.elements.pivot_filter_details).html(e)};PivotChart.prototype.defaults=function(){return{on_init:undefined,before_process:undefined,on_process:undefined,after_process:undefined,on_ready:undefined,chart:{}}};PivotChart.prototype.initialize=function(){var e=this,t=new $.Deferred;this.$elem.bind("update",function(){e.draw()});t.resolve();return t.promise()};PivotChart.prototype.generateSeriesData=function(e,t){var n=this;var r=[];var i={};t=$.extend(true,{},t);$.each(Object.keys(t),function(e,n){var i=/(\d+(?:.\d+))?(?:\s*)?\%/;if(i.test(t[n])){t[n]=parseFloat(t[n].toString().replace("%",""))}if(typeof t[n]!=="string")return;r.push(t[n])});$.each(Object.keys(t),function(n,s){if(typeof t[s]!=="number")return;var o=r.length==0?s:s+" ("+r.join(" ")+")";i[o]=[e,t[s]]});return i};PivotChart.prototype.draw=function(){var e=this;this.y_axes.reset();this.series=new PivotChartSeries(this.pivot,this.y_axes);this.$elem.empty();this.$elem.trigger("process");$.each(this.pivot.results().all(),function(t,n){var r=$.extend({},n);var i=r.rows[0];if(r.rows!==undefined)delete r.rows;delete r.Datum;var s=e.generateSeriesData(sd.mapRowDate(configurator.get_resolution(),i.report_date).chart,r);$.each(s,function(t,n){if(!e.series.exists(t))e.series.add(t);e.series.data(t,n)})});if(typeof this.pivot.config().columnLabels!=="undefined"&&this.pivot.config().columnLabels.length>0){this.$elem.trigger("fail",{message:"Chart cannot be drawn",description:"Your Pivottable contains at least one group field (columnLabel). Please remove that and re-add it as a data field (rowLabel)"});return}var t=[];$.each(this.y_axes.get(),function(e,n){t.push(n.get())});var n=[];$.each(this.series.get(),function(e,t){var r=t.options.options;r.name=t.name;if(typeof r.displayFunction==="function"){r.data=[];$.each(t.data,function(e,t){r.data.push([t[0],r.displayFunction(t[1])])})}else{r.data=t.data}r.data.sort(function(e,t){if(e[0]>t[0]&&e[1]>t[1])return 1;if(e[0]==t[0]&&e[1]==t[1])return 0;if(e[0]<t[0]&&e[1]<t[1])return-1});n.push(r)});this.options.chart=(new PivotChartConfig($.extend(true,{},{chart:{renderTo:this.$elem[0]},yAxis:t,series:n},this.options.chart))).get();this.chart=new Highcharts.Chart(this.options.chart);this.$elem.trigger("ready")};PivotChartYAxes.prototype.register=function(e,t){var n=new PivotChartYAxis(e,t,this.pivot_config);if(!this.exists(n.getName())&&!this.exists(n.getName(true))){this.axes.push(n);n.setIndex(this.axes.length)}return this.get(n.getName(true))};PivotChartYAxes.prototype.reset=function(){this.axes=[]};PivotChartYAxes.prototype.exists=function(e){return typeof this.get(e)!=="undefined"};PivotChartYAxes.prototype.get=function(e){var t;if(typeof e==="undefined")return this.axes;if(typeof e==="number")return{index:e,axis:this.axes[e].get()};$.each(this.axes,function(n,i){if(i.getName()==e||i.getName(true)==e){t={index:n,axis:i.get(),axis_object:i};return false}});return t};PivotChartYAxis.prototype.getYAxisConfigFromPivotField=function(){var e=this;var t={};$.each(this.pivot.config(true).fields,function(n,r){if(r.name==e.getName(true)&&typeof r.highcharts==="object"&&typeof r.highcharts.yAxis==="object"){t=r.highcharts.yAxis;return false}});return t};PivotChartYAxis.prototype.defaults=function(e){return{title:{text:e}}};PivotChartYAxis.prototype.setIndex=function(e){this.index=e};PivotChartYAxis.prototype.getIndex=function(){return this.index};PivotChartYAxis.prototype.getName=function(e){return typeof e==="boolean"&&e?this.getShortName():this.options.title.text};PivotChartYAxis.prototype.getShortName=function(){return this.options.title.text.replace(/ \(.+\)?.*/,"")};PivotChartYAxis.prototype.get=function(){return this.options};PivotChartYAxisConfig.prototype.defaults=function(){return{title:{text:"Unnamed y-Axis"}}};PivotChartYAxisConfig.prototype.get=function(){return this.options};PivotChartConfig.prototype.defaults=function(){return{chart:{zoomType:["x","xy"],resetZoomButton:{position:{align:"left",y:"0px",x:"0px"}}},title:{text:"Unnamed Chart"},credits:{enabled:false},xAxis:{type:"datetime"},plotOptions:{},yAxis:[],series:[]}};PivotChartConfig.prototype.get=function(){return this.options};PivotChartSeries.prototype.add=function(e,t){return this.series[e]=new PivotChartSingleSeries(this.y_axes,this.pivot,e,t)};PivotChartSeries.prototype.remove=function(e){if(this.exists(e))delete this.series[e]};PivotChartSeries.prototype.data=function(e,t){if(!this.exists(e))this.add(e,{});this.series[e].add(t)};PivotChartSeries.prototype.get=function(e){if(typeof e==="undefined")return this.series;return this.series[e]};PivotChartSeries.prototype.exists=function(e){return typeof this.series[e]!=="undefined"};PivotChartSingleSeries.prototype.getSeriesConfigFromPivotfield=function(){var e=this;var t={};$.each(this.pivot.config(true).fields,function(n,r){if(r.name==e.y_axis.axis_object.getName(true)&&typeof r.highcharts==="object"&&typeof r.highcharts.series==="object"){t=r.highcharts.series;return false}});if(Object.keys(t)==0){$.each(this.pivot.config(true).fields,function(n,r){if(r.name==e.name&&typeof r.highcharts==="object"&&typeof r.highcharts.series==="object"){t=r.highcharts.series;return false}})}return t};PivotChartSingleSeries.prototype.add=function(e){this.data.push(e)};PivotChartSingleSeries.prototype.getAxisName=function(){return this.name.replace(/\(.+\)?.*/,"")};PivotChartSingleSeries.prototype.getConfig=function(){return this.options};PivotChartSeriesConfig.prototype.defaults=function(){return{type:"spline"}};PivotChartSeriesConfig.prototype.get=function(){return this.options};pivot_table.prototype.defaults=function(){return{on_init:undefined,before_process:undefined,on_process:undefined,after_process:undefined,on_ready:undefined,elements:{pivot_table:"#pivot-table-"+uuid.v4(),pivot_table_body:"#pivot-table-body-"+uuid.v4()}}};pivot_table.prototype.initialize=function(){var e=this;$(this.$elem).bind("update",function(){e.update_results()})};pivot_table.prototype.update_results=function(){this.$elem.trigger("process");if(typeof this.options.before_process=="function"){$.proxy(this.options.before_process,this)()}var e=this.pivot.results().all(),t=this.pivot.config(),n=this.pivot.results().columns(),r="",i;var s=this.$elem,o;s.empty();r+='<table id="'+this.options.elements.pivot_table+'" class="table table-striped table-condensed"><thead>';if(t.columnLabels.length>0&&t.summaries.length>1){var u="",a="";$.each(t.summaries,function(e,t){u+="<th>"+t+"</th>"});r+="<tr>";$.each(n,function(e,t){switch(t.type){case"row":r+='<th rowspan="2">'+t.fieldName+"</th>";break;case"column":r+='<th colspan="'+t.width+'">'+t.fieldName+"</th>";a+=u;break}});r+="</tr><tr>"+a+"</tr>"}else{r+="<tr>";$.each(n,function(e,n){if(n.type!=="column"||t.summaries.length<=1){r+="<th>"+n.fieldName+"</th>"}else{$.each(t.summaries,function(e,t){r+="<th>"+t+"</th>"})}});r+="</tr>"}r+='</thead></tr><tbody id="'+this.options.elements.pivot_table_body+'"></tbody></table>';s.append(r);o=s.find("tbody");$.each(e,function(e,i){r="<tr>";$.each(n,function(e,n){if(n.type!=="column"){r+="<td>"+i[n.fieldName]+"</td>"}else{$.each(t.summaries,function(e,t){if(i[n.fieldName]!==undefined)r+="<td>"+i[n.fieldName][t]+"</td>";else r+="<td>&nbsp;</td>"})}});r+="</tr>";o.append(r)});if(typeof this.options.after_process=="function"){$.proxy(this.options.after_process,this)()}this.$elem.trigger("ready")};(function(e,t,n,r){"use: strict";function i(t,n){return this.each(function(){var r=e(this);var i=r.data("pivot.controller");var s=typeof t=="object"&&t;if(t=="destroy"){r.unbind().removeData();return}if(!i)r.data("pivot.controller",i=new PivotController(this,s));if(typeof t=="string")e.proxy(i[t],i,n)()})}var s=e.fn.PivotController;e.fn.PivotController=i;e.fn.PivotController.Constructor=PivotController;e.fn.PivotController.noConflict=function(){e.fn.PivotController=s;return this}})(jQuery,window,document);(function(e,t,n,r){"use: strict";function i(t,n){return this.each(function(){var r=e(this);var i=r.data("pivot.chart");var s=typeof t=="object"&&t;if(t=="destroy"){r.unbind().removeData();return}if(!i)r.data("pivot.chart",i=new PivotChart(this,s));if(typeof t=="string")e.proxy(i[t],i,n)()})}var s=e.fn.PivotChart;e.fn.PivotChart=i;e.fn.PivotChart.Constructor=PivotChart;e.fn.PivotChart.noConflict=function(){e.fn.PivotChart=s;return this}})(jQuery,window,document);(function(e,t,n,r){"use: strict";function i(t,n){return this.each(function(){var r=e(this);var i=r.data("pivot.table");var s=typeof t=="object"&&t;if(t=="destroy"){r.unbind().removeData();return}if(!i)r.data("pivot.table",i=new pivot_table(this,s));if(typeof t=="string")e.proxy(i[t],i,n)()})}var s=e.fn.PivotTable;e.fn.PivotTable=i;e.fn.PivotTable.Constructor=pivot_table;e.fn.PivotTable.noConflict=function(){e.fn.PivotTable=s;return this}})(jQuery,window,document)
